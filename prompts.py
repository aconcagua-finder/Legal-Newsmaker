#!/usr/bin/env python3
"""
–ü—Ä–æ–º–ø—Ç—ã –¥–ª—è –Ω–µ–π—Ä–æ–Ω–Ω—ã—Ö —Å–µ—Ç–µ–π –≤ –ø—Ä–æ–µ–∫—Ç–µ NEWSMAKER

–≠—Ç–æ—Ç —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å AI –º–æ–¥–µ–ª—è–º–∏:
- Perplexity Sonar Deep Research (–ø–æ–ª—É—á–µ–Ω–∏–µ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –Ω–æ–≤–æ—Å—Ç–µ–π)
- OpenAI GPT-Image-1 (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–º–∏–∫—Å–æ–≤)
"""

from datetime import datetime, timedelta


def get_yesterday_date() -> str:
    """–ü–æ–ª—É—á–∞–µ—Ç –≤—á–µ—Ä–∞—à–Ω—é—é –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ '–¥–µ–Ω—å –º–µ—Å—è—Ü'"""
    yesterday = datetime.now() - timedelta(days=1)
    months = {
        1: "—è–Ω–≤–∞—Ä—è", 2: "—Ñ–µ–≤—Ä–∞–ª—è", 3: "–º–∞—Ä—Ç–∞", 4: "–∞–ø—Ä–µ–ª—è",
        5: "–º–∞—è", 6: "–∏—é–Ω—è", 7: "–∏—é–ª—è", 8: "–∞–≤–≥—É—Å—Ç–∞", 
        9: "—Å–µ–Ω—Ç—è–±—Ä—è", 10: "–æ–∫—Ç—è–±—Ä—è", 11: "–Ω–æ—è–±—Ä—è", 12: "–¥–µ–∫–∞–±—Ä—è"
    }
    
    day = yesterday.day
    month = months[yesterday.month]
    return f"{day} {month}"


# =============================================================================
# –ü–†–û–ú–ü–¢–´ –î–õ–Ø PERPLEXITY API (–ø–æ–ª—É—á–µ–Ω–∏–µ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –Ω–æ–≤–æ—Å—Ç–µ–π)
# =============================================================================

def get_perplexity_system_prompt() -> str:
    """–°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è Perplexity AI"""
    return ("–¢—ã –æ–ø—ã—Ç–Ω—ã–π —é—Ä–∏—Å—Ç-–ø—Ä–∞–∫—Ç–∏–∫, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—â–∏–π—Å—è –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö "
            "–∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞. –û—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ, –ø–æ —Å—É—â–µ—Å—Ç–≤—É, —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ —Ñ–∞–∫—Ç–∞–º–∏ –∏ —Ü–∏—Ñ—Ä–∞–º–∏. "
            "–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –∏—â–∏ —Ç–æ–ª—å–∫–æ —Å–∞–º—ã–µ —Å–≤–µ–∂–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–Ω–∏, –ø—Ä–æ–≤–µ—Ä—è–π –¥–∞—Ç—ã –≤ –∏—Å—Ç–æ—á–Ω–∏–∫–∞—Ö! "
            "–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–π –Ω–æ–≤–æ—Å—Ç–∏ —Å–æ —Å–≤–µ–∂–∏–º–∏ –¥–∞—Ç–∞–º–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –∏–ª–∏ –Ω–µ–¥–∞–≤–Ω–∏–º –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ–º –≤ —Å–∏–ª—É.")


def get_perplexity_daily_collection_prompt() -> str:
    """–ü—Ä–æ–º–ø—Ç –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ —Å–±–æ—Ä–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å–Ω—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π"""
    
    return f"""–ü—Ä–æ–≤–µ–¥–∏ –≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∏ —Å–æ–±–µ—Ä–∏ –í–°–ï –∑–Ω–∞—á–∏–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ä–æ—Å—Å–∏–π—Å–∫–æ–º –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–µ –∑–∞ –í–ß–ï–†–ê.

üéØ –ó–ê–î–ê–ß–ê: –ù–∞–π–¥–∏ –†–û–í–ù–û 7 —Å–∞–º—ã—Ö –≤–∞–∂–Ω—ã—Ö –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å–Ω—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π –∑–∞ –≤—á–µ—Ä–∞—à–Ω–∏–π –¥–µ–Ω—å –∏ —Ä–∞–Ω–∂–∏—Ä—É–π –∏—Ö –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É.

–ö–†–ò–¢–ï–†–ò–ò –ü–†–ò–û–†–ò–¢–ï–¢–ê:
1. –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –≤–∞–∂–Ω–æ—Å—Ç—å - –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç –º–∏–ª–ª–∏–æ–Ω—ã –≥—Ä–∞–∂–¥–∞–Ω (–Ω–∞–ª–æ–≥–∏, –ø–æ—Å–æ–±–∏—è, —à—Ç—Ä–∞—Ñ—ã)
2. –û–ß–ï–ù–¨ –í–ê–ñ–ù–ê–Ø - –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Å—Ñ–µ—Ä–∞—Ö 
3. –í–ê–ñ–ù–ê–Ø - –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ–±–ª–∞—Å—Ç—è—Ö
4. –°–†–ï–î–ù–Ø–Ø - —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, —É—Ç–æ—á–Ω–µ–Ω–∏—è –ø—Ä–æ—Ü–µ–¥—É—Ä
5. –£–ú–ï–†–ï–ù–ù–ê–Ø - –æ—Ç—Ä–∞—Å–ª–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã
6. –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, —É–∑–∫–∏–µ –æ–±–ª–∞—Å—Ç–∏
7. –ù–ò–ó–ö–ê–Ø - –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –ø—Ä–æ—Ü–µ–¥—É—Ä–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã

–¢–†–ï–ë–û–í–ê–ù–ò–Ø –ö –ö–ê–ñ–î–û–ô –ù–û–í–û–°–¢–ò:
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ü–∏—Ñ—Ä—ã: —Å—É–º–º—ã, –ø—Ä–æ—Ü–µ–Ω—Ç—ã, —Å—Ä–æ–∫–∏, –¥–∞—Ç—ã
- –£–∫–∞–∑–∞–Ω–∏–µ –∫–æ–≥–æ –∏–º–µ–Ω–Ω–æ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ
- –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —ç—Ñ—Ñ–µ–∫—Ç –¥–ª—è –≥—Ä–∞–∂–¥–∞–Ω/–±–∏–∑–Ω–µ—Å–∞
- –¢–æ—á–Ω–∞—è –¥–∞—Ç–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è –≤ —Å–∏–ª—É –∏–ª–∏ –ø—Ä–∏–Ω—è—Ç–∏—è
- –ú–∏–Ω–∏–º—É–º 2-3 –Ω–∞–¥–µ–∂–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–∞

–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê (—Å—Ç—Ä–æ–≥–æ —Å–æ–±–ª—é–¥–∞–π —Å—Ç—Ä—É–∫—Ç—É—Ä—É):

–ü–†–ò–û–†–ò–¢–ï–¢ 1 - –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:
üìú [–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–∫–æ–Ω–∞/–∏–∑–º–µ–Ω–µ–Ω–∏—è]

üí¨ –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ô –ö–ê–†–ú–ê–ù–ù–û–ì–û –ö–û–ù–°–£–õ–¨–¢–ê–ù–¢–ê:

[–ü–µ—Ä–≤—ã–π –∞–±–∑–∞—Ü - —Å—É—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ —Ü–∏—Ñ—Ä–∞–º–∏]

[–í—Ç–æ—Ä–æ–π –∞–±–∑–∞—Ü - –∫–æ–≥–æ –∑–∞—Ç—Ä–æ–Ω–µ—Ç –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è]

[–¢—Ä–µ—Ç–∏–π –∞–±–∑–∞—Ü - –∏—Ä–æ–Ω–∏—á–Ω–æ–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ –∏–ª–∏ —Å–æ–≤–µ—Ç]

–ò–°–¢–û–ß–ù–ò–ö–ò:
üîó –ò—Å—Ç–æ—á–Ω–∏–∫ 1: [—Å—Å—ã–ª–∫–∞]
üîó –ò—Å—Ç–æ—á–Ω–∏–∫ 2: [—Å—Å—ã–ª–∫–∞]

---

–ü–†–ò–û–†–ò–¢–ï–¢ 2 - –û–ß–ï–ù–¨ –í–ê–ñ–ù–û:
[–ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç]

---

–ü–†–ò–û–†–ò–¢–ï–¢ 5 - –£–ú–ï–†–ï–ù–ù–ê–Ø:
[–ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç]

---

–ü–†–ò–û–†–ò–¢–ï–¢ 6 - –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø:
[–ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç]

---

–ü–†–ò–û–†–ò–¢–ï–¢ 7 - –ù–ò–ó–ö–ê–Ø:
[–ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç]

–ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ê –ï–°–õ–ò –ù–ï–¢ –°–í–ï–ñ–ò–• –ù–û–í–û–°–¢–ï–ô:
–ï—Å–ª–∏ –∑–∞ –≤—á–µ—Ä–∞ –Ω–µ—Ç –∑–Ω–∞—á–∏–º—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π, –Ω–∞–π–¥–∏ –≤–∞–∂–Ω—ã–µ –∑–∞–∫–æ–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ –í–°–¢–£–ü–ê–Æ–¢ –í –°–ò–õ–£ –≤ –±–ª–∏–∂–∞–π—à–∏–µ 2-4 –Ω–µ–¥–µ–ª–∏.
–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∂–∏: "–í—Å—Ç—É–ø–∞–µ—Ç –≤ —Å–∏–ª—É [–∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –¥–∞—Ç–∞]"

–°–¢–ò–õ–¨:
- –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π —Å –ª–µ–≥–∫–æ–π –∏—Ä–æ–Ω–∏–µ–π
- –ñ–∏–≤–æ–π —è–∑—ã–∫, –∫–∞–∫ –±—É–¥—Ç–æ –ø–∏—à–µ—Ç –æ–ø—ã—Ç–Ω—ã–π –ø—Ä–∞–∫—Ç–∏–∫
- 1-2 —ç–º–æ–¥–∑–∏ –Ω–∞ –Ω–æ–≤–æ—Å—Ç—å (—É–º–µ—Ä–µ–Ω–Ω–æ!)
- –ö–∞–∂–¥–∞—è –Ω–æ–≤–æ—Å—Ç—å 100-150 —Å–ª–æ–≤
- –§–æ–∫—É—Å –Ω–∞ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è –¥–ª—è –ª—é–¥–µ–π"""


def get_perplexity_news_prompt() -> str:
    """–û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ –æ–¥–Ω–æ–π –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å–Ω–æ–π –Ω–æ–≤–æ—Å—Ç–∏ (legacy)"""
    
    return f"""–ù–∞–π–¥–∏ –û–î–ù–û –≥–ª–∞–≤–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤ —Ä–æ—Å—Å–∏–π—Å–∫–æ–º –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–µ –∑–∞ –í–ß–ï–†–ê –∏–ª–∏ –°–ï–ì–û–î–ù–Ø.

–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û - –°–¢–†–û–ì–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ –ü–û –°–í–ï–ñ–ï–°–¢–ò:
1. –ù–æ–≤–æ—Å—Ç–∏ –¢–û–ß–ù–û –∑–∞ –≤—á–µ—Ä–∞ –∏–ª–∏ —Å–µ–≥–æ–¥–Ω—è
2. –ï—Å–ª–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 2 –¥–Ω—è –Ω–∏—á–µ–≥–æ –Ω–µ—Ç - –ª—É—á—à–µ –ù–ï –ü–£–ë–õ–ò–ö–û–í–ê–¢–¨ —á–µ–º –±—Ä–∞—Ç—å —Å—Ç–∞—Ä–æ–µ
3. –ù–ò–ö–û–ì–î–ê –Ω–µ –±–µ—Ä–∏ –Ω–æ–≤–æ—Å—Ç–∏ —Å—Ç–∞—Ä—à–µ 3 –¥–Ω–µ–π
4. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∂–∏ —Ç–æ—á–Ω—É—é –¥–∞—Ç—É –≤ —Ç–µ–∫—Å—Ç–µ –Ω–æ–≤–æ—Å—Ç–∏

–¢–†–ï–ë–û–í–ê–ù–ò–Ø:
- –ò–∑—É—á–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∏ –Ω–∞–π–¥–∏ –ö–û–ù–ö–†–ï–¢–ù–´–ï —Ü–∏—Ñ—Ä—ã: —Å—É–º–º—ã, –ø—Ä–æ—Ü–µ–Ω—Ç—ã, —Å—Ä–æ–∫–∏
- –ù–ï –ø–∏—à–∏ –æ–±—â–∏–µ —Ñ—Ä–∞–∑—ã –±–µ–∑ –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫–∏
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ö–û–ú–ü–ê–ö–¢–ù–´–ú (100-120 —Å–ª–æ–≤, 2-3 –∞–±–∑–∞—Ü–∞)
- –°—Ç–∏–ª—å: —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–π —Å –ª–µ–≥–∫–æ–π –∏—Ä–æ–Ω–∏–µ–π, –∫–∞–∫ –±—É–¥—Ç–æ –ø–∏—à–µ—Ç –∂–∏–≤–æ–π —á–µ–ª–æ–≤–µ–∫
- –ù–ï —Å—Ç–∞–≤—å –Ω–∏–∫–∞–∫–∏–µ –º–∞—Ä–∫–µ—Ä—ã —Å—Å—ã–ª–æ–∫ —Ç–∏–ø–∞ [1], [2] –≤ —Ç–µ–∫—Å—Ç–µ
- –ù–ï –¥–æ–±–∞–≤–ª—è–π –ø—Ä–∏–º–µ—á–∞–Ω–∏—è –ø–æ—Å–ª–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
- –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û —É–∫–∞–∂–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ –≤ —Å–µ–∫—Ü–∏–∏ –ò–°–¢–û–ß–ù–ò–ö–ò

–°–¢–ò–õ–¨ –ö–û–ú–ú–ï–ù–¢–ê–†–ò–Ø:
- –ü–∏—à–∏ –æ—Ç –ª–∏—Ü–∞ –æ–ø—ã—Ç–Ω–æ–≥–æ —é—Ä–∏—Å—Ç–∞-–ø—Ä–∞–∫—Ç–∏–∫–∞ —Å —á—É–≤—Å—Ç–≤–æ–º —é–º–æ—Ä–∞
- –ò—Å–ø–æ–ª—å–∑—É–π 1-2 —ç–º–æ–¥–∑–∏ –Ω–∞ –≤–µ—Å—å —Ç–µ–∫—Å—Ç (—É–º–µ—Ä–µ–Ω–Ω–æ!)
- –†–∞–∑–±–µ–π –Ω–∞ 2-3 –∫–æ—Ä–æ—Ç–∫–∏—Ö –∞–±–∑–∞—Ü–∞
- –ü–µ—Ä–≤—ã–π –∞–±–∑–∞—Ü - —Å—É—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ —Ü–∏—Ñ—Ä–∞–º–∏
- –í—Ç–æ—Ä–æ–π –∞–±–∑–∞—Ü - –∫–æ–≥–æ –∑–∞—Ç—Ä–æ–Ω–µ—Ç –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Å–æ–≤–µ—Ç
- –¢—Ä–µ—Ç–∏–π –∞–±–∑–∞—Ü (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - –∫–æ—Ä–æ—Ç–∫–æ–µ –∏—Ä–æ–Ω–∏—á–Ω–æ–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ

–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (–°–¢–†–û–ì–û –°–û–ë–õ–Æ–î–ê–ô):

üìú –§–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –∑–∞–∫–æ–Ω ‚Ññ123-–§–ó - —à—Ç—Ä–∞—Ñ—ã —É–≤–µ–ª–∏—á–µ–Ω—ã –≤–¥–≤–æ–µ

üí¨ –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ô –ö–ê–†–ú–ê–ù–ù–û–ì–û –ö–û–ù–°–£–õ–¨–¢–ê–ù–¢–ê:

–° 1 –∏—é–Ω—è –≤—Å—Ç—É–ø–∞–µ—Ç –≤ —Å–∏–ª—É –∑–∞–∫–æ–Ω –æ–± —É–≤–µ–ª–∏—á–µ–Ω–∏–∏ —à—Ç—Ä–∞—Ñ–æ–≤ –¥–ª—è –∞–≤—Ç–æ–º–æ–±–∏–ª–∏—Å—Ç–æ–≤. –¢–µ–ø–µ—Ä—å –∑–∞ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –Ω–∞ 20-40 –∫–º/—á –ø—Ä–∏–¥–µ—Ç—Å—è –≤—ã–ª–æ–∂–∏—Ç—å –Ω–µ 500, –∞ —Ü–µ–ª—ã—Ö 1000 —Ä—É–±–ª–µ–π. –ó–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –Ω–∞—Ä—É—à–µ–Ω–∏–µ - —É–∂–µ 2000 —Ä—É–±–ª–µ–π.

–û—Å–æ–±–µ–Ω–Ω–æ "–ø–æ–≤–µ–∑–µ—Ç" –ª—é–±–∏—Ç–µ–ª—è–º –ø–æ–≥–æ–Ω—è—Ç—å –Ω–∞ —Ç—Ä–∞—Å—Å–∞—Ö - —Ç–∞–º –∫–∞–º–µ—Ä—ã —Ñ–∏–∫—Å–∏—Ä—É—é—Ç –∫–∞–∂–¥–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ. –°–æ–≤–µ—Ç –ø—Ä–æ—Å—Ç–æ–π: –ª–∏–±–æ —Å–æ–±–ª—é–¥–∞–π—Ç–µ —Å–∫–æ—Ä–æ—Å—Ç–Ω–æ–π —Ä–µ–∂–∏–º, –ª–∏–±–æ –≥–æ—Ç–æ–≤—å—Ç–µ –∫–æ—à–µ–ª–µ–∫ –ø–æ—Ç–æ–ª—â–µ üí∞

–í –æ–±—â–µ–º, –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–æ –≤ –æ—á–µ—Ä–µ–¥–Ω–æ–π —Ä–∞–∑ –Ω–∞–ø–æ–º–∏–Ω–∞–µ—Ç: –ª—É—á—à–∏–π —Å–ø–æ—Å–æ–± –ø–æ–ø–æ–ª–Ω–∏—Ç—å –±—é–¥–∂–µ—Ç - —ç—Ç–æ –∫–∞—Ä–º–∞–Ω –∞–≤—Ç–æ–º–æ–±–∏–ª–∏—Å—Ç–∞.

–ò–°–¢–û–ß–ù–ò–ö–ò:
üîó –ò—Å—Ç–æ—á–Ω–∏–∫: https://sozd.duma.gov.ru/bill/123456-8

–í–ê–ñ–ù–û: 
- –ü–∏—à–∏ –∂–∏–≤—ã–º —è–∑—ã–∫–æ–º, –Ω–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ
- –°—Ç—Ä–æ–≥–æ 100-120 —Å–ª–æ–≤ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
- –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –≤–∫–ª—é—á–∏ —Ä–∞–∑–¥–µ–ª –ò–°–¢–û–ß–ù–ò–ö–ò —Å —Ä–µ–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–æ–π
- –î–∞—Ç–∞ –Ω–æ–≤–æ—Å—Ç–∏ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —Å–≤–µ–∂–µ–π!

–ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ù–´–ï –ò–°–¢–û–ß–ù–ò–ö–ò –î–õ–Ø –ü–û–ò–°–ö–ê:
- –°–∞–π—Ç –ì–æ—Å–¥—É–º—ã (duma.gov.ru) - –∑–∞–∫–æ–Ω–æ–ø—Ä–æ–µ–∫—Ç—ã –∏ –ø—Ä–∏–Ω—è—Ç—ã–µ –∑–∞–∫–æ–Ω—ã
- –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –ø–æ—Ä—Ç–∞–ª—ã –≤–µ–¥–æ–º—Å—Ç–≤ (nalog.gov.ru, pfr.gov.ru –∏ –¥—Ä.)
- –ü–æ—Ä—Ç–∞–ª –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã—Ö –∞–∫—Ç–æ–≤ (pravo.gov.ru)
- –ù–æ–≤–æ—Å—Ç–Ω—ã–µ –∞–≥–µ–Ω—Ç—Å—Ç–≤–∞ —Å –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω–æ–π –¥–∞—Ç–æ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–∏

–ï–°–õ–ò –ù–ï –ù–ê–ô–î–ï–ù–û –°–í–ï–ñ–ò–• –ù–û–í–û–°–¢–ï–ô –ó–ê –í–ß–ï–†–ê-–°–ï–ì–û–î–ù–Ø:
–ù–∞–π–¥–∏ –≤–∞–∂–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –¢–û–õ–¨–ö–û –í–°–¢–£–ü–ê–ï–¢ –í –°–ò–õ–£ –≤ –±–ª–∏–∂–∞–π—à–∏–µ 2-4 –Ω–µ–¥–µ–ª–∏.
–≠—Ç–æ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–∫–æ–Ω, –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª –ø—Ä–∏–Ω—è—Ç —Ä–∞–Ω–µ–µ, –Ω–æ –Ω–∞—á–∏–Ω–∞–µ—Ç –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å –≤ —Ç–µ–∫—É—â–µ–º –∏–ª–∏ —Å–ª–µ–¥—É—é—â–µ–º –º–µ—Å—è—Ü–µ.
–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∂–∏ –≤ —Ç–µ–∫—Å—Ç–µ: "–í—Å—Ç—É–ø–∞–µ—Ç –≤ —Å–∏–ª—É [—Ç–æ—á–Ω–∞—è –¥–∞—Ç–∞]"

–ö–ê–¢–ï–ì–û–†–ò–ß–ï–°–ö–ò –ó–ê–ü–†–ï–©–ï–ù–û:
- –ë—Ä–∞—Ç—å –Ω–æ–≤–æ—Å—Ç–∏ —Å—Ç–∞—Ä—à–µ –Ω–µ–¥–µ–ª–∏ –±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –¥–∞—Ç—ã –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è –≤ —Å–∏–ª—É
- –ü–∏—Å–∞—Ç—å –ø—Ä–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –¥–∞–≤–Ω–æ –¥–µ–π—Å—Ç–≤—É—é—Ç"""


# =============================================================================
# –ü–†–û–ú–ü–¢–´ –î–õ–Ø OPENAI API (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–º–∏–∫—Å–æ–≤)
# =============================================================================

def get_openai_comic_styles() -> list:
    """–°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å—Ç–∏–ª–µ–π –¥–ª—è –∫–æ–º–∏–∫—Å–æ–≤ (—Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π)"""
    return [
        "photorealistic digital art, dramatic lighting, 4-panel comic layout"
    ]


def get_openai_comic_prompt(context: str, chosen_style: str) -> str:
    """–°–æ–∑–¥–∞–µ—Ç –ø—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ 4-–ø–∞–Ω–µ–ª—å–Ω–æ–≥–æ –∫–æ–º–∏–∫—Å–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–æ–≤–æ—Å—Ç–µ–π"""
    
    return f"""Create a 4-panel comic strip about Russian legal news:

TOPIC: {context}

STYLE: Realistic style, photographic quality

4-PANEL LAYOUT:
Panel 1: Setup - Character discovers the legal change (reading phone/paper)
Panel 2: Reaction - Character processes the information (confused/surprised look)
Panel 3: Understanding - Character realizes the implications (lightbulb moment)
Panel 4: Resolution - Character adapts to new reality (acceptance/action)

VISUAL REQUIREMENTS:
- NO TEXT OR SPEECH BUBBLES
- Photorealistic modern Russian characters
- Clear visual storytelling without words
- Contemporary settings (office, home, street)
- Expressive faces and body language
- Easy to understand sequence

CHARACTER DESIGN:
- Everyday Russian people (office workers, parents, drivers, etc.)
- Appropriate clothing for situation
- Clear facial expressions showing emotion progression
- Relatable appearance

COMPOSITION:
- 4 equal panels arranged horizontally
- Clean layout with clear panel separation
- Good lighting and contrast in each panel
- Focus on character expressions and actions
- Professional quality illustration

The comic should tell a complete story about how regular people discover and adapt to the legal change, using only visual storytelling without any text."""


def get_openai_test_prompt() -> str:
    """–ü—Ä–æ—Å—Ç–æ–π –ø—Ä–æ–º–ø—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è OpenAI API"""
    return "Simple test image: a small blue circle on white background"


# =============================================================================
# –£–¢–ò–õ–ò–¢–´ –î–õ–Ø –†–ê–ë–û–¢–´ –° –ü–†–û–ú–ü–¢–ê–ú–ò
# =============================================================================

def extract_news_key_points(news_content: str) -> list:
    """
    –ò–∑–≤–ª–µ–∫–∞–µ—Ç –∫–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã –∏–∑ –Ω–æ–≤–æ—Å—Ç–µ–π –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ –∫–æ–º–∏–∫—Å–∞
    
    Args:
        news_content: –¢–µ–∫—Å—Ç –Ω–æ–≤–æ—Å—Ç–µ–π –æ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
        
    Returns:
        list: –°–ø–∏—Å–æ–∫ –∫–ª—é—á–µ–≤—ã—Ö —Ñ–∞–∫—Ç–æ–≤
    """
    key_points = []
    lines = news_content.split('\n')
    
    for line in lines:
        if 'üìú' in line:
            # –ò–∑–≤–ª–µ–∫–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
            key_points.append(f"Legal document: {line.replace('üìú', '').strip()}")
        elif any(keyword in line.lower() for keyword in 
                ['—à—Ç—Ä–∞—Ñ', '–Ω–∞–ª–æ–≥', '–∑–∞–∫–æ–Ω', '–∑–∞–ø—Ä–µ—Ç', '–ª—å–≥–æ—Ç–∞', '–ø–æ—Å–æ–±–∏–µ']):
            # –í–∞–∂–Ω—ã–µ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ —Ç–µ—Ä–º–∏–Ω—ã
            key_points.append(line.strip())
    
    return key_points[:3]  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–≤—ã–µ 3 –∫–ª—é—á–µ–≤—ã—Ö –º–æ–º–µ–Ω—Ç–∞


def get_comic_context_from_news(news_content: str) -> str:
    """
    –°–æ–∑–¥–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –∫–æ–º–∏–∫—Å–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–æ–≤–æ—Å—Ç–µ–π
    
    Args:
        news_content: –ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –Ω–æ–≤–æ—Å—Ç–µ–π
        
    Returns:
        str: –ö—Ä–∞—Ç–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    """
    key_points = extract_news_key_points(news_content)
    return ' '.join(key_points)


def parse_collected_news(raw_content: str) -> list:
    """
    –ü–∞—Ä—Å–∏—Ç —Å–æ–±—Ä–∞–Ω–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏ –∏–∑ –æ—Ç–≤–µ—Ç–∞ Deep Research
    
    Args:
        raw_content: –°—ã—Ä–æ–π –æ—Ç–≤–µ—Ç –æ—Ç Deep Research
        
    Returns:
        list: –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å –Ω–æ–≤–æ—Å—Ç—è–º–∏
    """
    news_list = []
    
    # –†–∞–∑–¥–µ–ª—è–µ–º –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º
    sections = raw_content.split('–ü–†–ò–û–†–ò–¢–ï–¢ ')
    
    for i, section in enumerate(sections[1:], 1):  # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–≤—É—é –ø—É—Å—Ç—É—é —Å–µ–∫—Ü–∏—é
        try:
            # –ò–∑–≤–ª–µ–∫–∞–µ–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ —Å–µ–∫—Ü–∏–∏
            priority_line = section.split('\n')[0]
            if '–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û' in priority_line:
                priority = 1
            elif '–û–ß–ï–ù–¨ –í–ê–ñ–ù–û' in priority_line:
                priority = 2
            elif '–í–ê–ñ–ù–û' in priority_line and '–û–ß–ï–ù–¨' not in priority_line:
                priority = 3
            elif '–°–†–ï–î–ù–Ø–Ø' in priority_line:
                priority = 4
            elif '–£–ú–ï–†–ï–ù–ù–ê–Ø' in priority_line:
                priority = 5
            elif '–î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø' in priority_line:
                priority = 6
            elif '–ù–ò–ó–ö–ê–Ø' in priority_line:
                priority = 7
            else:
                priority = i  # fallback –ø–æ –ø–æ—Ä—è–¥–∫—É
            
            # –†–∞–∑–¥–µ–ª—è–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∏
            if '–ò–°–¢–û–ß–ù–ò–ö–ò:' in section:
                content_part, sources_part = section.split('–ò–°–¢–û–ß–ù–ò–ö–ò:', 1)
            else:
                content_part = section
                sources_part = ""
            
            # –ò–∑–≤–ª–µ–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ (—Å—Ç—Ä–æ–∫–∞ —Å üìú)
            title = ""
            content_lines = content_part.split('\n')
            for line in content_lines:
                if 'üìú' in line:
                    title = line.replace('üìú', '').strip()
                    break
            
            # –ò–∑–≤–ª–µ–∫–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç (–≤—Å–µ –∫—Ä–æ–º–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞)
            content = '\n'.join(content_lines[1:]).strip()
            
            # –ò–∑–≤–ª–µ–∫–∞–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫–∏
            sources = []
            if sources_part:
                for line in sources_part.split('\n'):
                    if 'üîó' in line and 'http' in line:
                        # –ò—â–µ–º URL –≤ —Å—Ç—Ä–æ–∫–µ
                        import re
                        url_match = re.search(r'https?://[^\s\)]+', line)
                        if url_match:
                            # –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ —Å–∏–º–≤–æ–ª—ã –≤ –∫–æ–Ω—Ü–µ URL
                            clean_url = url_match.group().rstrip('.,;:)')
                            sources.append(clean_url)
            
            if title and content:  # –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç
                news_item = {
                    'priority': priority,
                    'title': title,
                    'content': content,
                    'sources': sources
                }
                news_list.append(news_item)
                
        except Exception as e:
            # –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É –ø–∞—Ä—Å–∏–Ω–≥–∞ –Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º
            print(f"–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å–µ–∫—Ü–∏–∏ {i}: {e}")
            continue
    
    # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É
    news_list.sort(key=lambda x: x['priority'])
    
    return news_list


# =============================================================================
# –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ü–†–û–ú–ü–¢–û–í
# =============================================================================

class PromptConfig:
    """–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –ø—Ä–æ–º–ø—Ç–æ–≤"""
    
    # Perplexity –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    PERPLEXITY_MAX_TOKENS = 900  # –î–ª—è –æ–¥–∏–Ω–æ—á–Ω—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π
    PERPLEXITY_COLLECTION_MAX_TOKENS = 8192  # –ú–∞–∫—Å–∏–º—É–º –¥–ª—è Deep Research –ø—Ä–∏ —Å–±–æ—Ä–µ
    PERPLEXITY_TEMPERATURE = 0.2
    PERPLEXITY_TOP_P = 0.9
    
    # OpenAI –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    OPENAI_IMAGE_SIZE = "1536x1024"
    OPENAI_IMAGE_QUALITY = "medium"  # low, medium, high, auto
    OPENAI_IMAGE_COUNT = 1
    
    # –û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    COMMENT_WORD_LIMIT = 120
    SIMILARITY_THRESHOLD = 0.7